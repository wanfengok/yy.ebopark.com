<extend name="Public/base"/>
<block name="style">
    <style>
        .operateBtn{
            font-size:12px;
            padding:0px 5px;
            color:blue;

        }
        .operateBtn:hover{
            cursor:pointer;
        }
        .td1 {
            text-align: right;
            width: 100px;
        }
        .td2 {
            text-align: left;
            width: 160px;
        }
    </style>
</block>
<block name="body">
    <div class="main-title">
        <h2 id="mytitle"></h2>
    </div>
<form action="./add" method="post">
    <input id="id" name="id" type="hidden" value="0"/>
    <input id="project" name="project" type="hidden" value=""/>
    <table cellpadding="4" cellspacing="2">
        <tr>
            <td class="td1">
                <label for="username">用户名:</label>
            </td>
            <td class="td2">
                <input id="username" name="username"/>
            </td>
            <td class="td1">
                <label for="pwd">密码:</label>
            </td>
            <td>
                <input type="password" id="pwd" name="pwd"/>
            </td>
        </tr>
        <tr>
            <td class="td1">
                <label for="realname">姓名:</label>
            </td>
            <td class="td2">
                <input id="realname" name="realname"/>
            </td>
            <td class="td1">
                <label for="mobile">手机号:</label>
            </td>
            <td>
                <input id="mobile" name="mobile"/>
            </td>
        </tr>
        <tr>
            <td class="td1">
                <label for="email">邮箱:</label>
            </td>
            <td class="td2">
                <input id="email" name="email"/>
            </td>
            <td class="td1">
                <label for="projects">活动:</label>
            </td>
            <td>
                <div id="projects" style="width:100%">
                </div>
            </td>
        </tr>
        <tr>
            <td class="td1">
                <label for="storename">商家门店名称:</label>
            </td>
            <td class="td2">
                <input id="storename" name="storename"/>
            </td>
            <td class="td1">
            </td>
            <td>
            </td>
        </tr>
        <tr>
            <td class="td1">
                <label for="merchantname">商户名称:</label>
            </td>
            <td class="td2">
                <input id="merchantname" name="merchantname"/>
            </td>
            <td class="td1">
                <label for="merchantAddr">商户地址:</label>
            </td>
            <td>
                <input id="merchantaddr" name="merchantaddr"/>
            </td>
        </tr>
        <tr>
            <td class="td1">
                <label for="merchanttel">联系电话:</label>
            </td>
            <td class="td2">
                <input id="merchanttel" name="merchanttel"/>
            </td>
            <td class="td1">
            </td>
            <td>
            </td>
        </tr>
    </table>
    <div id="sample_2_wrapper" class="dataTables_wrapper form-inline" role="grid" style="padding-left:10px;">
        <p><input id="sub" type="submit" value="添加" onclick="return submiting()"/></p>
    </div>
</form>
</block>
<block name="script">
    <script type="text/javascript" src="__PUBLIC__/static/layer/layer.js"></script>
    <script type="text/javascript">
        var activities=null;
        function submiting(){
            if($("#username").val().length==0){
                alert("用户名不能为空！");
                $("#username").focus();
                return false;
            }
            if($("#pwd").val().length==0){
                alert("密码不能为空！");
                $("#pwd").focus();
                return false;
            }
            if($("#storename").val().length==0){
                alert("商家门店名称不能为空！");
                $("#storename").focus();
                return false;
            }
            if($("#merchantname").val().length==0){
                alert("商户名称不能为空！");
                $("#merchantname").focus();
                return false;
            }
            if($("#merchantaddr").val().length==0){
                alert("商户地址不能为空！");
                $("#merchantaddr").focus();
                return false;
            }
            if($("#merchanttel").val().length==0){
                alert("联系电话不能为空！");
                $("#merchanttel").focus();
                return false;
            }
            if($("#project").val().length==0){
                alert("请选择活动！");
                $("#project").focus();
                return false;
            }
            return true;
        }
        $(function(){
            activities=eval({$activity});
            var i=0;
            for(i=0;i<activities.length;i++){
                var obj=activities[i];
                $("<lable style='margin-right:5px'><input name='p' type='checkbox' onclick='_change()'  value='"+obj.activitycode+"'/>"+obj.activityname+"</lable>").appendTo($("#projects"));
            }

            var id="{$id}";
            if(id=="0"){
                $("#sub").val("添加");
                $("#mytitle").html("新增商户&nbsp;&nbsp;&nbsp;");
            }else {
                $("#sub").val("修改");
                $("#id").val(id);
                var json=eval({$json});
                $("#username").val(json.username);
                $("#realname").val(json.realname);
                $("#email").val(json.email);
                $("#mobile").val(json.mobile);
                $("#merchantname").val(json.merchantname);

                var em=document.getElementsByName("p");
                var pa=json.project.split(',');
                for(var i=0;i<em.length;i++){
                    var obj=em[i];
                    if(pa.indexOf(obj.value)>-1) {
                        $(obj).attr("checked",true);
                    }
                    else{
                        $(obj).attr("checked",false);
                    }
                }
                $("#project").val(json.project);
                $("#pwd").val(json.pwd);
                $("#storename").val(json.storename);
                $("#merchantaddr").val(json.merchantaddr);
                $("#merchanttel").val(json.merchanttel);
                $("#mytitle").html("修改商户&nbsp;&nbsp;&nbsp;");
            }
        });

        function _change() {
            var str = "";
            var em = document.getElementsByName("p");
            for (var i = 0; i < em.length; i++) {
                var obj = em[i];
                if (obj.checked) {
                    str += $(obj).val()+",";
                }
            }
            if (str.length > 0)str = str.substring(0,str.length-1);
            $("#project").val(str);

        }
    </script>
</block>
